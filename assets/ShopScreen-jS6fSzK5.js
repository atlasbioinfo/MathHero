import{f as K,a as Q,e as L,K as Y,g as te,r as R,i as ne,h as f,_ as U,d as oe,o as s,j as t,p as e,t as a,I as y,l as ce,q as I,m as C,z as w,C as N,L as le,x as T,s as q,F as P,k as A,B as O,D as x,J,N as Z,M as ie,O as re,P as ue,Q as de,R as ve,S as pe}from"./index-BvcESE9k.js";function he(){const o=K(),v=Q(),c=L(),m=Y(),{playPurchaseSound:u,playUnlockSound:l}=te(),{purchaseCelebration:i,unlockCelebration:_}=ne(),n=f(()=>c.t),r=R(!1),p=R(null);function g({operation:d,level:E,price:z}){const H=n.value.levels.level+" "+E;p.value={type:"level",operation:d,level:E,price:z,icon:"ðŸ”“",name:`${n.value.operations[d]} - ${H}`},r.value=!0}function $(d){p.value={type:"sticker",id:d.id,price:d.price,icon:d.icon,name:n.value.shop.stickers[d.nameKey]||d.nameKey},r.value=!0}function F(d){p.value={type:"frame",id:d.id,price:d.price,icon:"ðŸ–¼ï¸",name:n.value.shop.frames[d.nameKey]||d.nameKey},r.value=!0}function k(d){p.value={type:"background",id:d.id,price:d.price,icon:d.preview,name:n.value.shop.backgrounds[d.nameKey]||d.nameKey},r.value=!0}function S(d){var E;p.value={type:"avatar",id:d.id,price:d.price,icon:d.preview,name:((E=n.value.shop.avatars)==null?void 0:E[d.nameKey])||d.nameKey},r.value=!0}function V(){if(!p.value)return!1;const{type:d,id:E,price:z,operation:H,level:M}=p.value;let j=!1;return d==="level"?o.spendCoins(z,"level_unlock",`${H}_${M}`)&&(v.purchaseUnlock(H,M),j=!0,l(),_()):(j=o.purchaseItem(E,z,d),j&&(u(),i())),j?m.success(n.value.shop.purchaseSuccess):m.error(n.value.shop.purchaseFailed),r.value=!1,p.value=null,j}function W(){r.value=!1,p.value=null}return{showConfirmDialog:r,pendingPurchase:p,confirmLevelPurchase:g,confirmStickerPurchase:$,confirmFramePurchase:F,confirmBackgroundPurchase:k,confirmAvatarPurchase:S,executePurchase:V,cancelPurchase:W}}const me={class:"level-icon"},fe={class:"level-info"},_e={class:"level-name"},ke={class:"level-title"},ye={class:"operation-name"},ge={key:0,class:"unlock-badge"},be={__name:"LevelUnlockCard",props:{operation:{type:String,required:!0},level:{type:Number,required:!0}},emits:["purchase"],setup(o,{emit:v}){const c=o,m=v,u=K(),l=Q(),i=oe(),_=L(),n=f(()=>_.t),r=f(()=>le[c.level]),p=f(()=>u.canAfford(r.value)),g=f(()=>l.getOperationProgress(c.operation).unlockedLevel>=c.level);function $(){return c.level===6?(i.gender==="prince"?n.value.levels.princeTitle:n.value.levels.princessTitle)[c.operation]:n.value.levels.levelNames[c.level]}function F(){!g.value&&p.value&&m("purchase",{operation:c.operation,level:c.level,price:r.value})}return(k,S)=>(s(),t("div",{class:C(["level-unlock-card",{unlocked:g.value,affordable:p.value&&!g.value}]),onClick:F},[e("div",me,a(y(ce)[o.level]),1),e("div",fe,[e("div",_e,[I(a(n.value.levels.level)+" "+a(o.level)+" ",1),e("span",ke,a($()),1)]),e("div",ye,a(n.value.operations[o.operation]),1)]),g.value?(s(),t("div",ge,[S[0]||(S[0]=e("span",{class:"check-icon"},"âœ“",-1)),I(" "+a(n.value.shop.unlocked),1)])):(s(),t("div",{key:1,class:C(["price-badge",{unaffordable:!p.value}])},[w(N,{size:16}),I(" "+a(r.value),1)],2))],2))}},$e=U(be,[["__scopeId","data-v-18d82252"]]),Se={class:"sticker-icon"},qe={class:"sticker-name"},Ce={key:0,class:"owned-badge"},Pe={__name:"StickerShopCard",props:{sticker:{type:Object,required:!0}},emits:["purchase"],setup(o,{emit:v}){const c=o,m=v,u=K(),l=L(),i=f(()=>l.t),_=f(()=>u.canAfford(c.sticker.price)),n=f(()=>u.hasPurchasedItem(c.sticker.id));function r(){return i.value.shop.stickers[c.sticker.nameKey]||c.sticker.nameKey}function p(){!n.value&&_.value&&m("purchase",c.sticker)}return(g,$)=>(s(),t("div",{class:C(["sticker-shop-card",{owned:n.value,affordable:_.value&&!n.value}]),onClick:p},[e("div",Se,a(o.sticker.icon),1),e("div",qe,a(r()),1),n.value?(s(),t("div",Ce,[...$[0]||($[0]=[e("span",null,"âœ“",-1)])])):(s(),t("div",{key:1,class:C(["price-badge",{unaffordable:!_.value}])},[w(N,{size:12}),I(" "+a(o.sticker.price),1)],2))],2))}},we=U(Pe,[["__scopeId","data-v-afcdd8a4"]]),Ie={class:"frame-preview"},Ae={key:0,class:"frame-decoration"},Fe={class:"frame-info"},Be={class:"frame-name"},De={key:0,class:"equipped-badge"},Ee={key:1,class:"owned-badge"},Ke={__name:"FrameShopCard",props:{frame:{type:Object,required:!0}},emits:["purchase","equip"],setup(o,{emit:v}){const c=o,m=v,u=K(),l=L(),i=f(()=>l.t),_=f(()=>u.canAfford(c.frame.price)),n=f(()=>u.hasPurchasedItem(c.frame.id)),r=f(()=>u.equippedFrame===c.frame.id);function p(){return i.value.shop.frames[c.frame.nameKey]||c.frame.nameKey}function g(){n.value?m("equip",c.frame):_.value&&m("purchase",c.frame)}return($,F)=>(s(),t("div",{class:C(["frame-shop-card",{owned:n.value,equipped:r.value,affordable:_.value&&!n.value}]),onClick:g},[e("div",Ie,[e("div",{class:C(["frame-ring",{animated:o.frame.animated}]),style:T({background:o.frame.gradient,borderWidth:`${o.frame.borderWidth}px`})},[...F[0]||(F[0]=[e("div",{class:"avatar-placeholder"},[e("span",{class:"avatar-emoji"},"ðŸ‘¤")],-1)])],6),o.frame.decoration?(s(),t("span",Ae,a(o.frame.decoration),1)):q("",!0)]),e("div",Fe,[e("div",Be,a(p()),1),r.value?(s(),t("div",De,a(i.value.shop.equipped),1)):n.value?(s(),t("div",Ee,a(i.value.shop.owned),1)):(s(),t("div",{key:2,class:C(["price-badge",{unaffordable:!_.value}])},[w(N,{size:13}),I(" "+a(o.frame.price),1)],2))])],2))}},Le=U(Ke,[["__scopeId","data-v-fe4450df"]]),Ve={class:"preview-effects"},xe={key:0,class:"ocean-effect"},Ne={key:1,class:"stars-effect"},Ue={key:2,class:"forest-effect"},ze={key:3,class:"aurora-effect"},je={key:4,class:"falling-effect"},Oe={key:5,class:"sunset-effect"},Te="ðŸŒ¸",He="ðŸ¬",X="â˜ï¸",Me={__name:"BackgroundPreviewEffects",props:{themeId:{type:String,required:!0}},setup(o){const v=o,c=f(()=>v.themeId==="bg_sakura"?Te:He);return(m,u)=>(s(),t("div",Ve,[o.themeId==="bg_ocean"?(s(),t("div",xe,[u[0]||(u[0]=e("div",{class:"wave"},null,-1)),(s(),t(P,null,A(5,l=>e("span",{key:"b"+l,class:"mini-bubble",style:T({left:l*18+"%",animationDelay:l*.3+"s"})},null,4)),64))])):q("",!0),o.themeId==="bg_space"||o.themeId==="bg_galaxy"?(s(),t("div",Ne,[(s(),t(P,null,A(8,l=>e("span",{key:"s"+l,class:"mini-star",style:T({left:l*12+"%",top:10+l*10%70+"%",animationDelay:l*.2+"s"})},null,4)),64))])):q("",!0),o.themeId==="bg_forest"?(s(),t("div",Ue,[(s(),t(P,null,A(4,l=>e("span",{key:"f"+l,class:"mini-firefly",style:T({left:15+l*20+"%",top:20+l*15+"%",animationDelay:l*.5+"s"})},null,4)),64))])):q("",!0),o.themeId==="bg_aurora"?(s(),t("div",ze,[...u[1]||(u[1]=[e("div",{class:"aurora-band aurora-band-1"},null,-1),e("div",{class:"aurora-band aurora-band-2"},null,-1)])])):q("",!0),o.themeId==="bg_sakura"||o.themeId==="bg_candy"?(s(),t("div",je,[(s(),t(P,null,A(6,l=>e("span",{key:"fall"+l,class:"mini-fall",style:T({left:l*15+"%",animationDelay:l*.4+"s"})},a(c.value),5)),64))])):q("",!0),o.themeId==="bg_sunset"?(s(),t("div",Oe,[e("span",{class:"mini-cloud mini-cloud-1"},a(X)),e("span",{class:"mini-cloud mini-cloud-2"},a(X))])):q("",!0)]))}},Re={class:"particles"},We={class:"preview-icon"},Je={class:"bg-info"},Qe={class:"bg-name"},Ge={class:"bg-desc"},Xe={class:"bg-action"},Ye={key:0,class:"equipped-badge"},Ze={key:1,class:"owned-badge"},es={__name:"BackgroundShopCard",props:{bg:{type:Object,required:!0}},emits:["purchase","equip"],setup(o,{emit:v}){const c=o,m=v,u=K(),l=L(),i=f(()=>l.t),_=f(()=>u.canAfford(c.bg.price)),n=f(()=>u.hasPurchasedItem(c.bg.id)),r=f(()=>u.equippedBackground===c.bg.id),p=f(()=>i.value.shop.backgrounds[c.bg.nameKey]||c.bg.nameKey),g=f(()=>i.value.shop.backgrounds[c.bg.description]||"");function $(){n.value?m("equip",c.bg):_.value&&m("purchase",c.bg)}return(F,k)=>(s(),t("div",{class:C(["background-shop-card",{owned:n.value,equipped:r.value,affordable:_.value&&!n.value}]),onClick:$},[e("div",{class:C(["bg-preview",o.bg.id]),style:T({background:o.bg.gradient})},[w(Me,{"theme-id":o.bg.id},null,8,["theme-id"]),e("div",Re,[(s(!0),t(P,null,A(o.bg.particles.slice(0,4),(S,V)=>(s(),t("span",{key:V,class:C(["particle","particle-"+o.bg.id]),style:T({animationDelay:`${V*.5}s`})},a(S),7))),128))]),e("div",We,a(o.bg.preview),1)],6),e("div",Je,[e("div",Qe,a(p.value),1),e("div",Ge,a(g.value),1)]),e("div",Xe,[r.value?(s(),t("div",Ye,[k[0]||(k[0]=e("span",null,"âœ“",-1)),I(" "+a(i.value.shop.equipped),1)])):n.value?(s(),t("div",Ze,a(i.value.shop.tapToEquip),1)):(s(),t("div",{key:2,class:C(["price-badge",{unaffordable:!_.value}])},[w(N,{size:14}),I(" "+a(o.bg.price),1)],2))])],2))}},ss=U(es,[["__scopeId","data-v-321982c7"]]),as={class:"avatar-preview"},ts=["src","alt"],ns={class:"preview-emoji"},os={class:"avatar-info"},cs={class:"avatar-name"},ls={key:0,class:"equipped-badge"},is={key:1,class:"owned-badge"},rs={__name:"AvatarShopCard",props:{avatar:{type:Object,required:!0}},emits:["purchase","equip"],setup(o,{emit:v}){const c=o,m=v,u=K(),l=L(),i="/MathHero/",_=f(()=>l.t),n=f(()=>u.canAfford(c.avatar.price)),r=f(()=>u.hasPurchasedItem(c.avatar.id)),p=f(()=>u.equippedAvatar===c.avatar.id),g=f(()=>`${i}${c.avatar.image}`);function $(){var k;return((k=_.value.shop.avatars)==null?void 0:k[c.avatar.nameKey])||c.avatar.nameKey}function F(){r.value?m("equip",c.avatar):n.value&&m("purchase",c.avatar)}return(k,S)=>(s(),t("div",{class:C(["avatar-shop-card",{owned:r.value,equipped:p.value,affordable:n.value&&!r.value}]),onClick:F},[e("div",as,[e("img",{src:g.value,alt:$(),class:"avatar-image"},null,8,ts),e("span",ns,a(o.avatar.preview),1)]),e("div",os,[e("div",cs,a($()),1),p.value?(s(),t("div",ls,[S[0]||(S[0]=e("span",null,"âœ“",-1)),I(" "+a(_.value.shop.equipped),1)])):r.value?(s(),t("div",is,a(_.value.shop.tapToEquip),1)):(s(),t("div",{key:2,class:C(["price-badge",{unaffordable:!n.value}])},[w(N,{size:14}),I(" "+a(o.avatar.price),1)],2))])],2))}},us=U(rs,[["__scopeId","data-v-94953938"]]),ds={class:"confirm-content"},vs={class:"confirm-item"},ps={class:"confirm-icon"},hs={class:"confirm-name"},ms={class:"confirm-price"},fs={class:"balance-after"},_s={class:"confirm-actions"},ks={__name:"PurchaseConfirmDialog",props:{modelValue:{type:Boolean,required:!0},purchase:{type:Object,default:null}},emits:["update:modelValue","confirm","cancel"],setup(o,{emit:v}){const c=o,m=v,u=K(),l=L(),i=f(()=>l.t),_=f(()=>{var n;return u.balance-(((n=c.purchase)==null?void 0:n.price)||0)});return(n,r)=>(s(),O(y(Z),{show:o.modelValue,preset:"card",style:{"max-width":"350px"},closable:!1},{header:x(()=>[e("span",null,a(i.value.shop.confirmPurchase),1)]),footer:x(()=>[e("div",_s,[w(y(J),{onClick:r[0]||(r[0]=p=>m("cancel"))},{default:x(()=>[I(a(i.value.common.cancel),1)]),_:1}),w(y(J),{type:"primary",onClick:r[1]||(r[1]=p=>m("confirm"))},{default:x(()=>[I(a(i.value.shop.buy),1)]),_:1})])]),default:x(()=>{var p,g,$;return[e("div",ds,[e("div",vs,[e("span",ps,a((p=o.purchase)==null?void 0:p.icon),1),e("span",hs,a((g=o.purchase)==null?void 0:g.name),1)]),e("div",ms,[w(N,{size:24}),I(" "+a(($=o.purchase)==null?void 0:$.price),1)]),e("div",fs,a(i.value.shop.balanceAfter)+": "+a(_.value),1)])]}),_:1},8,["show"]))}},ys=U(ks,[["__scopeId","data-v-e48e798d"]]),gs={class:"transactions-list"},bs={class:"total-stats"},$s={class:"stat"},Ss={class:"stat-label"},qs={class:"stat-value earn"},Cs={class:"stat"},Ps={class:"stat-label"},ws={class:"stat-value spend"},Is={key:0,class:"empty-transactions"},As={class:"tx-info"},Fs={class:"tx-reason"},Bs={class:"tx-date"},Ds={__name:"TransactionHistoryModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(o){const v=K(),c=L(),m=f(()=>c.t);function u(i){return i.reason.startsWith("purchase_")?m.value.shop.transactionReasons.purchase:i.reason==="level_unlock"?m.value.shop.transactionReasons.levelUnlock:i.reason==="level_complete"?m.value.shop.transactionReasons.levelComplete:i.reason}function l(i){const _=new Date(i),n=c.currentLocale==="zh"?"zh-CN":"en-US";return _.toLocaleDateString(n,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}return(i,_)=>(s(),O(y(Z),{show:o.modelValue,preset:"card",style:{"max-width":"400px"},"onUpdate:show":_[0]||(_[0]=n=>i.$emit("update:modelValue",n))},{header:x(()=>[e("span",null,a(m.value.shop.transactionHistory),1)]),default:x(()=>[e("div",gs,[e("div",bs,[e("div",$s,[e("span",Ss,a(m.value.shop.totalEarned)+":",1),e("span",qs,[w(N,{size:16}),I(" "+a(y(v).totalEarned),1)])]),e("div",Cs,[e("span",Ps,a(m.value.shop.totalSpent)+":",1),e("span",ws,[w(N,{size:16}),I(" "+a(y(v).totalSpent),1)])])]),y(v).transactionHistory.length===0?(s(),t("div",Is,a(m.value.shop.noTransactions),1)):q("",!0),(s(!0),t(P,null,A(y(v).transactionHistory,n=>(s(),t("div",{key:n.id,class:C(["transaction-item",n.type])},[e("div",As,[e("span",Fs,a(u(n)),1),e("span",Bs,a(l(n.timestamp)),1)]),e("span",{class:C(["tx-amount",n.type])},a(n.type==="earn"?"+":"-")+a(n.amount),3)],2))),128))])]),_:1},8,["show"]))}},Es=U(Ds,[["__scopeId","data-v-ca5bd8f0"]]),Ks={class:"shop-screen"},Ls={class:"shop-header"},Vs={class:"header-left"},xs={class:"shop-title"},Ns={class:"shop-tabs"},Us=["onClick"],zs={class:"tab-icon"},js={class:"tab-label"},Os={class:"shop-content"},Ts={key:0,class:"tab-content"},Hs={class:"section-desc"},Ms={class:"level-unlock-list"},Rs={key:0,class:"empty-state"},Ws={key:1,class:"tab-content"},Js={class:"series-title"},Qs={class:"sticker-grid"},Gs={key:2,class:"tab-content"},Xs={class:"section-desc"},Ys={class:"frames-grid"},Zs={key:3,class:"tab-content"},ea={class:"section-desc"},sa={class:"avatars-grid"},aa={key:4,class:"tab-content"},ta={class:"section-desc"},na={class:"backgrounds-grid"},oa={__name:"ShopScreen",emits:["back"],setup(o){const v=K(),c=Q(),m=L(),u=Y(),{showConfirmDialog:l,pendingPurchase:i,confirmLevelPurchase:_,confirmStickerPurchase:n,confirmFramePurchase:r,confirmBackgroundPurchase:p,confirmAvatarPurchase:g,executePurchase:$,cancelPurchase:F}=he(),k=f(()=>m.t),S=R("stickers"),V=R(!1),W=[{key:"levels",icon:"ðŸ”“"},{key:"stickers",icon:"ðŸŽ¨"},{key:"avatars",icon:"ðŸ¦"},{key:"frames",icon:"ðŸ–¼ï¸"},{key:"backgrounds",icon:"ðŸŒˆ"}],d=["addition","subtraction","multiplication","division"],E=f(()=>d.every(B=>z(B).length===0));function z(B){const b=c.getOperationProgress(B),h=[];for(let D=2;D<=6;D++)b.unlockedLevel<D&&h.push(D);return h}function H(B){v.equipFrame(B.id),u.success(k.value.shop.equipped)}function M(){v.equipFrame(null)}function j(B){v.equipBackground(B.id),u.success(k.value.shop.equipped)}function ee(){v.equipBackground(null)}function se(B){v.equipAvatar(B.id),u.success(k.value.shop.equipped)}function ae(){v.equipAvatar(null)}return(B,b)=>(s(),t("div",Ks,[e("div",Ls,[e("div",Vs,[w(y(J),{quaternary:"",circle:"",onClick:b[0]||(b[0]=h=>B.$emit("back"))},{icon:x(()=>[...b[4]||(b[4]=[e("span",{style:{"font-size":"24px"}},"â†",-1)])]),_:1}),w(ie,{clickable:"",onClick:b[1]||(b[1]=h=>V.value=!0)})]),e("h2",xs,[b[5]||(b[5]=e("span",{class:"shop-icon"},"ðŸª",-1)),I(" "+a(k.value.shop.title),1)]),b[6]||(b[6]=e("div",{class:"header-spacer"},null,-1))]),e("div",Ns,[(s(),t(P,null,A(W,h=>e("button",{key:h.key,class:C(["tab-btn",{active:S.value===h.key}]),onClick:D=>S.value=h.key},[e("span",zs,a(h.icon),1),e("span",js,a(k.value.shop.tabs[h.key]),1)],10,Us)),64))]),e("div",Os,[S.value==="levels"?(s(),t("div",Ts,[e("div",Hs,a(k.value.shop.levelUnlockDesc),1),e("div",Ms,[(s(),t(P,null,A(d,h=>(s(),t(P,{key:h},[(s(!0),t(P,null,A(z(h),D=>(s(),O($e,{key:`${h}_${D}`,operation:h,level:D,onPurchase:y(_)},null,8,["operation","level","onPurchase"]))),128))],64))),64))]),E.value?(s(),t("div",Rs,[b[7]||(b[7]=e("span",{class:"empty-icon"},"ðŸŽ‰",-1)),e("p",null,a(k.value.shop.allLevelsUnlocked),1)])):q("",!0)])):q("",!0),S.value==="stickers"?(s(),t("div",Ws,[(s(!0),t(P,null,A(y(re),(h,D)=>(s(),t("div",{key:D,class:"sticker-series"},[e("h3",Js,a(k.value.shop.stickerSeries[D]),1),e("div",Qs,[(s(!0),t(P,null,A(h,G=>(s(),O(we,{key:G.id,sticker:G,onPurchase:y(n)},null,8,["sticker","onPurchase"]))),128))])]))),128))])):q("",!0),S.value==="frames"?(s(),t("div",Gs,[e("div",Xs,a(k.value.shop.framesDesc),1),e("div",Ys,[(s(!0),t(P,null,A(y(ue),h=>(s(),O(Le,{key:h.id,frame:h,onPurchase:y(r),onEquip:H},null,8,["frame","onPurchase"]))),128))]),y(v).equippedFrame?(s(),t("button",{key:0,class:"unequip-btn",onClick:M},a(k.value.shop.removeFrame),1)):q("",!0)])):q("",!0),S.value==="avatars"?(s(),t("div",Zs,[e("div",ea,a(k.value.shop.avatarsDesc),1),e("div",sa,[(s(!0),t(P,null,A(y(de),h=>(s(),O(us,{key:h.id,avatar:h,onPurchase:y(g),onEquip:se},null,8,["avatar","onPurchase"]))),128))]),y(v).equippedAvatar?(s(),t("button",{key:0,class:"unequip-btn",onClick:ae},a(k.value.shop.removeAvatar),1)):q("",!0)])):q("",!0),S.value==="backgrounds"?(s(),t("div",aa,[e("div",ta,a(k.value.shop.backgroundsDesc),1),e("div",na,[(s(!0),t(P,null,A(y(ve),h=>(s(),O(ss,{key:h.id,bg:h,onPurchase:y(p),onEquip:j},null,8,["bg","onPurchase"]))),128))]),y(v).equippedBackground?(s(),t("button",{key:0,class:"unequip-btn",onClick:ee},a(k.value.shop.removeBackground),1)):q("",!0)])):q("",!0)]),w(ys,{modelValue:y(l),"onUpdate:modelValue":b[2]||(b[2]=h=>pe(l)?l.value=h:null),purchase:y(i),onConfirm:y($),onCancel:y(F)},null,8,["modelValue","purchase","onConfirm","onCancel"]),w(Es,{modelValue:V.value,"onUpdate:modelValue":b[3]||(b[3]=h=>V.value=h)},null,8,["modelValue"])]))}},la=U(oa,[["__scopeId","data-v-51ad5dd4"]]);export{la as default};
