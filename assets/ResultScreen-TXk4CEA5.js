import{u as ye,a as he,b as fe,c as ge,d as pe,e as Z,f as _e,g as ee,n as ke,h as p,l as we,r as z,i as te,_ as U,o,j as i,F as R,k as D,m as V,p as t,t as n,q as x,s as _,v as $e,w as Se,x as X,y as xe,z as q,C as G,A as J,B as ne,D as O,E as Ce,T as be,G as Ae,H as qe,I as s,J as W}from"./index-BvcESE9k.js";const Te={1:1,2:2,3:3,4:4,5:5,6:6},Re={1:10,2:20,3:35,4:50,5:70,6:100},Be={1:15,2:30,3:50,4:75,5:100,6:150},Ie={1:5,2:10,3:15,4:20,5:30,6:50};function Ne(e,r,l=0){const a={correctAnswers:0,levelCompletion:0,perfectScore:0,noRetryBonus:0,total:0};return a.correctAnswers=r*Te[e],r>=7&&(a.levelCompletion=Re[e]),r===10&&(a.perfectScore=Be[e],l===0&&(a.noRetryBonus=Ie[e])),a.total=a.correctAnswers+a.levelCompletion+a.perfectScore+a.noRetryBonus,a}function Le(e){const r=ye(),l=he(),a=fe(),c=ge(),T=pe(),y=Z(),C=_e(),{playVictorySound:k,playApplauseSound:b,playCoinSound:d}=ee(),{celebratePerfect:L,starBurst:A,rainbowCelebration:u,coinRain:h}=te(),v=p(()=>y.t),m=z(!1),f=z([]),w=z([]),$=z(null),I=z(null),M=z(!1),P=z([]),E=p(()=>r.correctCount===10?"perfect":r.correctCount>=8?"excellent":r.correctCount>=7?"good":"tryAgain"),F=p(()=>y.getRandomMessage(`result.encouragement.${E.value}`)),N=p(()=>{switch(E.value){case"perfect":return"ðŸŽ†";case"excellent":return"â­";case"good":return"ðŸŒˆ";default:return"ðŸ¤—"}}),B=p(()=>{switch(E.value){case"perfect":return"fireworks";case"excellent":return"stars";case"good":return"rainbow";default:return"hug"}}),Q=p(()=>{switch(B.value){case"fireworks":return"ðŸŽ†";case"stars":return"â­";case"rainbow":return"ðŸŒˆ";case"hug":return"ðŸ¤—";default:return"âœ¨"}}),H=p(()=>r.correctCount>=7),K=p(()=>e.level<6),se=p(()=>{if(!K.value)return"";const g=e.level+1;return g===6?(T.gender==="prince"?v.value.levels.princeTitle:v.value.levels.princessTitle)[e.operation]:v.value.levels.levelNames[g]}),oe=p(()=>K.value?we[e.level+1]:""),re=p(()=>K.value?v.value.result.nextLevelHint[e.level]:""),ie=p(()=>r.correctCount>=9?"excellent":r.correctCount>=7?"good":"try-again");function ce(g){const S=g/10*360,j=g/10*.5;return{"--angle":`${S}deg`,"--delay":`${j}s`}}function ae(g){const S=Math.floor(g/60),j=g%60;return`${S}:${j.toString().padStart(2,"0")}`}function le(g){var S,j;return g.operationKey&&g.typeKey?`${((S=v.value.operations)==null?void 0:S[g.operationKey])||g.operationKey} ${((j=v.value.stickerWall)==null?void 0:j[g.typeKey])||g.typeKey}`:g.name||""}function ue(){M.value=!1}function de(){r.correctCount===10?(k(),setTimeout(()=>{b(),L()},300),setTimeout(()=>h(),800)):r.correctCount>=9?(k(),setTimeout(()=>{b(),A()},500)):r.correctCount>=7&&(k(),setTimeout(()=>u(),300))}function ve(){const g=[...f.value.map(S=>({icon:S.icon,name:le(S),description:""})),...w.value.map(S=>{var j,Y;return{icon:S.icon,name:((j=v.value.achievements)==null?void 0:j[S.nameKey])||S.nameKey,description:((Y=v.value.achievements)==null?void 0:Y[S.descKey])||""}})];P.value=g,setTimeout(()=>{M.value=!0},1200)}async function me(){if(r.wrongCount>0&&(m.value=!0),I.value=Ne(e.level,r.correctCount,r.retriedCount),c.recordSession(e.operation,r.correctCount,10,r.timeUsed),I.value.total>0&&(C.addCoins(I.value.total,"level_complete",{operation:e.operation,level:e.level,correctCount:r.correctCount}),await ke(),setTimeout(()=>{d(),$.value&&$.value.triggerFromCenter(Math.min(I.value.total/10,8))},500)),H.value){l.completeLevel(e.operation,e.level,r.correctCount,r.accuracy);const g=l.getOperationProgress(e.operation);f.value=a.checkAndAwardStickers(e.operation,g.completedLevels,r.accuracy);const S={isPerfect:r.correctCount===10,retriedCount:r.retriedCount,timeUsed:r.timeUsed,streakDays:c.streakDays,totalEarned:C.totalEarned,totalQuestions:c.totalQuestions,allOperationsMastered:l.areAllOperationsMastered(),allLevelsPerfect:!1};w.value=a.checkHiddenAchievements(S),de(),(f.value.length>0||w.value.length>0)&&ve()}}return{gameStore:r,localeStore:y,t:v,showReview:m,newStickers:f,newAchievements:w,coinAnimationRef:$,coinRewards:I,showStickerUnlock:M,unlockStickers:P,encouragementType:E,encouragementMessage:F,encouragementEmoji:N,animationType:B,animationEmoji:Q,isLevelPassed:H,hasNextLevel:K,nextLevelName:se,nextLevelIcon:oe,nextLevelHint:re,resultClass:ie,particleStyle:ce,formatTime:ae,closeStickerUnlock:ue,initializeResult:me}}const Me={class:"question-review"},Ue={class:"review-number"},Pe={class:"review-question"},Ee={class:"mini-fraction"},je={key:0,class:"mini-fraction"},ze={class:"review-answer"},Ke={key:0,class:"correct-answer"},De={class:"review-status"},Fe={key:0,class:"status-icon correct"},He={key:1,class:"status-icon wrong"},Oe={key:2,class:"retried-badge"},Ve={__name:"QuestionReview",props:{answers:{type:Array,required:!0},operation:{type:String,required:!0}},setup(e){const r=e,l=Z(),a=p(()=>l.t),c=p(()=>$e[r.operation]),T=p(()=>c.value.isFraction),y=p(()=>c.value.symbol);function C(k){return!k||typeof k!="object"?k:`${k.numerator}/${k.denominator}`}return(k,b)=>(o(),i("div",Me,[(o(!0),i(R,null,D(e.answers,(d,L)=>{var A;return o(),i("div",{key:L,class:V(["review-item",{correct:d.isCorrect,wrong:!d.isCorrect}])},[t("div",Ue,n(L+1),1),t("div",Pe,[T.value?(o(),i(R,{key:1},[t("span",Ee,n(d.question.fraction1.numerator)+"/"+n(d.question.fraction1.denominator),1),x(" "+n(d.question.operation)+" ",1),d.question.fraction2?(o(),i("span",je,n(d.question.fraction2.numerator)+"/"+n(d.question.fraction2.denominator),1)):_("",!0),d.question.integer?(o(),i(R,{key:1},[x(n(d.question.integer),1)],64)):_("",!0),b[0]||(b[0]=x(" = ",-1))],64)):(o(),i(R,{key:0},[x(n(d.question.num1)+" "+n(y.value)+" "+n(d.question.num2)+" = ",1)],64))]),t("div",ze,[t("span",{class:V(["user-answer",{strike:!d.isCorrect}])},[T.value?(o(),i(R,{key:1},[x(n(C(d.userAnswer)),1)],64)):(o(),i(R,{key:0},[x(n(d.userAnswer),1)],64))],2),d.isCorrect?_("",!0):(o(),i("span",Ke,[b[1]||(b[1]=x(" â†’ ",-1)),T.value?(o(),i(R,{key:1},[x(n(C(d.correctAnswer)),1)],64)):(o(),i(R,{key:0},[x(n(d.correctAnswer),1)],64))]))]),t("div",De,[d.isCorrect?(o(),i("span",Fe,"âœ“")):(o(),i("span",He,"âœ—")),d.retried?(o(),i("span",Oe,n((A=a.value.game)==null?void 0:A.retriedBadge),1)):_("",!0)])],2)}),128))]))}},Qe=U(Ve,[["__scopeId","data-v-b4a0b7ab"]]),We=["src"],Xe={__name:"CoinAnimation",props:{targetSelector:{type:String,default:".coin-display"}},setup(e,{expose:r}){const l="/MathHero/",a=p(()=>`${l}coin.svg`),c=e,T=z(null),y=xe([]);let C=0;function k(){const u=document.querySelector(c.targetSelector);if(!u)return{x:window.innerWidth/2,y:50};const h=u.getBoundingClientRect();return{x:h.left+h.width/2,y:h.top+h.height/2}}function b(u,h,v=1,m=null){const f=k(),w=Math.min(v,10);for(let $=0;$<w;$++){const I={id:++C,style:{left:`${u}px`,top:`${h}px`,"--target-x":`${f.x-u}px`,"--target-y":`${f.y-h}px`,animationDelay:`${$*80}ms`}};y.push(I),setTimeout(()=>{const M=y.findIndex(P=>P.id===I.id);M!==-1&&y.splice(M,1),$===w-1&&m&&m()},800+$*80)}}function d(u,h=1,v=null){const m=u.getBoundingClientRect(),f=m.left+m.width/2,w=m.top+m.height/2;b(f,w,h,v)}function L(u=1,h=null){const v=window.innerWidth/2,m=window.innerHeight/2;b(v,m,u,h)}function A(u,h,v=5,m=null){const f=k(),w=Math.min(v,15);for(let $=0;$<w;$++){const I=(Math.random()-.5)*100,M=(Math.random()-.5)*100,P=u+I,E=h+M,F={id:++C,style:{left:`${P}px`,top:`${E}px`,"--target-x":`${f.x-P}px`,"--target-y":`${f.y-E}px`,animationDelay:`${$*50}ms`}};y.push(F),setTimeout(()=>{const N=y.findIndex(B=>B.id===F.id);N!==-1&&y.splice(N,1),$===w-1&&m&&m()},700+$*50)}}return Se(()=>{y.splice(0,y.length)}),r({triggerCoinAnimation:b,triggerFromElement:d,triggerFromCenter:L,triggerSpread:A}),(u,h)=>(o(),i("div",{class:"coin-animation-container",ref_key:"containerRef",ref:T},[(o(!0),i(R,null,D(y,v=>(o(),i("img",{key:v.id,src:a.value,class:"flying-coin",style:X(v.style),alt:"coin"},null,12,We))),128))],512))}},Ye=U(Xe,[["__scopeId","data-v-7aff658a"]]),Ge={key:0,class:"coin-rewards"},Je={class:"coin-title"},Ze={class:"coin-breakdown"},et={key:0,class:"coin-row"},tt={class:"coin-value"},nt={key:1,class:"coin-row"},st={class:"coin-value"},ot={key:2,class:"coin-row highlight"},rt={class:"coin-value"},it={key:3,class:"coin-row highlight"},ct={class:"coin-value"},at={class:"coin-total"},lt={class:"total-value"},ut={__name:"CoinRewards",props:{rewards:{type:Object,default:null},earnedText:{type:String,required:!0},correctAnswersText:{type:String,required:!0},levelBonusText:{type:String,required:!0},perfectBonusText:{type:String,required:!0},noRetryBonusText:{type:String,required:!0},totalText:{type:String,required:!0}},setup(e){return(r,l)=>e.rewards&&e.rewards.total>0?(o(),i("div",Ge,[t("h3",Je,[q(G,{size:20}),x(" "+n(e.earnedText),1)]),t("div",Ze,[e.rewards.correctAnswers>0?(o(),i("div",et,[t("span",null,n(e.correctAnswersText),1),t("span",tt,"+"+n(e.rewards.correctAnswers),1)])):_("",!0),e.rewards.levelCompletion>0?(o(),i("div",nt,[t("span",null,n(e.levelBonusText),1),t("span",st,"+"+n(e.rewards.levelCompletion),1)])):_("",!0),e.rewards.perfectScore>0?(o(),i("div",ot,[t("span",null,n(e.perfectBonusText),1),t("span",rt,"+"+n(e.rewards.perfectScore),1)])):_("",!0),e.rewards.noRetryBonus>0?(o(),i("div",it,[t("span",null,n(e.noRetryBonusText),1),t("span",ct,"+"+n(e.rewards.noRetryBonus),1)])):_("",!0),t("div",at,[t("span",null,n(e.totalText),1),t("span",lt,[q(G,{size:18}),x(" "+n(e.rewards.total),1)])])])])):_("",!0)}},dt=U(ut,[["__scopeId","data-v-0170c5b0"]]),vt={class:"particle-container"},mt={class:"sticker-showcase"},yt={class:"sticker-icon-large"},ht={class:"unlock-title"},ft={class:"sticker-name"},gt={key:0,class:"sticker-desc"},pt={key:1,class:"sticker-nav"},_t=["onClick"],kt={__name:"StickerUnlockEffect",props:{show:{type:Boolean,default:!1},stickers:{type:Array,default:()=>[]},title:{type:String,default:"New Sticker!"},closeText:{type:String,default:"Awesome!"}},emits:["close"],setup(e,{emit:r}){const l=e,a=r,{playStickerSound:c}=ee(),{starBurst:T}=te(),y=z(0),C=p(()=>l.stickers[y.value]),k=["âœ¨","â­","ðŸŒŸ","ðŸ’«","ðŸŽ‰","ðŸŽŠ","ðŸ’–","ðŸŒˆ","ðŸ¦‹","ðŸŒ¸"];function b(A){const u=A/20*360,h=80+Math.random()*60,v=Math.random()*.5,m=1.5+Math.random()*1,f=16+Math.random()*12;return{"--angle":`${u}deg`,"--distance":`${h}px`,"--delay":`${v}s`,"--duration":`${m}s`,"--size":`${f}px`}}function d(A){return k[A%k.length]}function L(){a("close")}return J(()=>l.show,A=>{A&&l.stickers.length>0&&(y.value=0,c(),setTimeout(()=>T(),300))}),J(y,()=>{l.show&&l.stickers.length>1&&c()}),(A,u)=>(o(),ne(Ae,{to:"body"},[q(be,{name:"sticker-unlock"},{default:O(()=>{var h,v,m;return[e.show?(o(),i("div",{key:0,class:"sticker-unlock-overlay",onClick:L},[t("div",{class:"sticker-unlock-container",onClick:u[0]||(u[0]=Ce(()=>{},["stop"]))},[t("div",vt,[(o(),i(R,null,D(20,f=>t("span",{key:f,class:"particle",style:X(b(f))},n(d(f)),5)),64))]),u[2]||(u[2]=t("div",{class:"glow-ring"},null,-1)),u[3]||(u[3]=t("div",{class:"glow-ring delay-1"},null,-1)),u[4]||(u[4]=t("div",{class:"glow-ring delay-2"},null,-1)),t("div",mt,[t("div",yt,n((h=C.value)==null?void 0:h.icon),1),u[1]||(u[1]=t("div",{class:"shine-effect"},null,-1))]),t("h2",ht,n(e.title),1),t("p",ft,n((v=C.value)==null?void 0:v.name),1),(m=C.value)!=null&&m.description?(o(),i("p",gt,n(C.value.description),1)):_("",!0),e.stickers.length>1?(o(),i("div",pt,[(o(!0),i(R,null,D(e.stickers,(f,w)=>(o(),i("span",{key:w,class:V(["nav-dot",{active:w===y.value}]),onClick:$=>y.value=w},null,10,_t))),128))])):_("",!0),t("button",{class:"close-btn",onClick:L},n(e.closeText),1)])])):_("",!0)]}),_:1})]))}},wt=U(kt,[["__scopeId","data-v-21db3250"]]),$t={class:"result-stats"},St={class:"stat-item"},xt={class:"stat-value correct"},Ct={class:"stat-label"},bt={class:"stat-item"},At={class:"stat-value wrong"},qt={class:"stat-label"},Tt={class:"stat-item"},Rt={class:"stat-value"},Bt={class:"stat-label"},It={class:"stat-item"},Nt={class:"stat-value"},Lt={class:"stat-label"},Mt={__name:"ResultStats",props:{correctCount:{type:Number,required:!0},wrongCount:{type:Number,required:!0},accuracy:{type:Number,required:!0},timeUsed:{type:Number,required:!0},labels:{type:Object,required:!0}},setup(e){const r=e,l=p(()=>{const a=Math.floor(r.timeUsed/60),c=r.timeUsed%60;return`${a}:${c.toString().padStart(2,"0")}`});return(a,c)=>(o(),i("div",$t,[t("div",St,[t("div",xt,n(e.correctCount),1),t("div",Ct,n(e.labels.correct),1)]),t("div",bt,[t("div",At,n(e.wrongCount),1),t("div",qt,n(e.labels.wrong),1)]),t("div",Tt,[t("div",Rt,n(e.accuracy)+"%",1),t("div",Bt,n(e.labels.accuracy),1)]),t("div",It,[t("div",Nt,n(l.value),1),t("div",Lt,n(e.labels.time),1)])]))}},Ut=U(Mt,[["__scopeId","data-v-99d29750"]]),Pt={key:0,class:"new-stickers"},Et={class:"sticker-list"},jt={class:"sticker-icon"},zt={class:"sticker-name"},Kt={__name:"NewStickersSection",props:{stickers:{type:Array,required:!0},title:{type:String,required:!0}},setup(e){return(r,l)=>e.stickers.length>0?(o(),i("div",Pt,[t("h3",null,n(e.title),1),t("div",Et,[(o(!0),i(R,null,D(e.stickers,a=>(o(),i("div",{key:a.id,class:"new-sticker-item"},[t("span",jt,n(a.icon),1),t("span",zt,n(a.name),1)]))),128))])])):_("",!0)}},Dt=U(Kt,[["__scopeId","data-v-83c1f87d"]]),Ft={key:0,class:"new-achievements"},Ht={class:"achievement-list"},Ot={class:"achievement-icon"},Vt={class:"achievement-name"},Qt={__name:"NewAchievementsSection",props:{achievements:{type:Array,required:!0},title:{type:String,required:!0}},setup(e){return(r,l)=>e.achievements.length>0?(o(),i("div",Ft,[t("h3",null,n(e.title),1),t("div",Ht,[(o(!0),i(R,null,D(e.achievements,a=>(o(),i("div",{key:a.id,class:"achievement-item"},[t("span",Ot,n(a.icon),1),t("span",Vt,n(a.name),1)]))),128))])])):_("",!0)}},Wt=U(Qt,[["__scopeId","data-v-bce3e585"]]),Xt={key:0,class:"next-level-preview"},Yt={class:"next-level-icon"},Gt={class:"next-level-hint"},Jt={__name:"NextLevelPreview",props:{show:{type:Boolean,required:!0},nextLevelIsText:{type:String,required:!0},levelName:{type:String,required:!0},icon:{type:String,required:!0},hint:{type:String,required:!0}},setup(e){return(r,l)=>e.show?(o(),i("div",Xt,[t("p",null,[x(n(e.nextLevelIsText)+" ",1),t("strong",null,n(e.levelName),1)]),t("span",Yt,n(e.icon),1),t("p",Gt,n(e.hint),1)])):_("",!0)}},Zt=U(Jt,[["__scopeId","data-v-e760cf05"]]),en={__name:"EncouragementAnimation",props:{type:{type:String,required:!0},emoji:{type:String,required:!0}},setup(e){function r(l){const a=l/10*360,c=l/10*.5;return{"--angle":`${a}deg`,"--delay":`${c}s`}}return(l,a)=>(o(),i("div",{class:V(["encouragement-animation",e.type])},[(o(),i(R,null,D(10,c=>t("span",{key:c,class:"particle",style:X(r(c))},n(e.emoji),5)),64))],2))}},tn=U(en,[["__scopeId","data-v-940f8283"]]),nn={class:"result-screen"},sn={class:"result-icon"},on={class:"result-title"},rn={key:0,class:"retried-info"},cn={key:1,class:"unlock-message"},an={class:"result-actions"},ln={key:2,class:"question-review"},un={__name:"ResultScreen",props:{operation:{type:String,required:!0},level:{type:Number,required:!0}},emits:["home","retry","next"],setup(e){const r=e,{gameStore:l,localeStore:a,t:c,showReview:T,newStickers:y,newAchievements:C,coinAnimationRef:k,coinRewards:b,showStickerUnlock:d,unlockStickers:L,encouragementMessage:A,encouragementEmoji:u,animationType:h,animationEmoji:v,isLevelPassed:m,hasNextLevel:f,nextLevelName:w,nextLevelIcon:$,nextLevelHint:I,resultClass:M,closeStickerUnlock:P,initializeResult:E}=Le(r),F=p(()=>C.value.map(N=>({id:N.id,icon:N.icon,name:c.value.achievements[N.nameKey]})));return qe(()=>{E()}),(N,B)=>{var Q,H;return o(),i("div",nn,[t("div",{class:V(["result-container",s(M)])},[q(tn,{type:s(h),emoji:s(v)},null,8,["type","emoji"]),t("div",sn,n(s(u)),1),t("h2",on,n(s(A)),1),q(Ut,{"correct-count":s(l).correctCount,"wrong-count":s(l).wrongCount,accuracy:s(l).accuracy,"time-used":s(l).timeUsed,labels:{correct:s(c).result.correct,wrong:s(c).result.wrong,accuracy:s(c).result.accuracy,time:s(c).result.time}},null,8,["correct-count","wrong-count","accuracy","time-used","labels"]),s(l).retriedCount>0?(o(),i("div",rn,n(s(a).translate("result.retriedInfo",{count:s(l).retriedCount})),1)):_("",!0),q(dt,{rewards:s(b),"earned-text":s(c).coins.earned,"correct-answers-text":s(c).coins.correctAnswers,"level-bonus-text":s(c).coins.levelBonus,"perfect-bonus-text":s(c).coins.perfectBonus,"no-retry-bonus-text":s(c).coins.noRetryBonus,"total-text":s(c).coins.total},null,8,["rewards","earned-text","correct-answers-text","level-bonus-text","perfect-bonus-text","no-retry-bonus-text","total-text"]),s(m)&&s(f)?(o(),i("div",cn,n(s(c).result.unlockMessage),1)):_("",!0),q(Dt,{stickers:s(y),title:s(c).result.newStickers},null,8,["stickers","title"]),q(Wt,{achievements:F.value,title:s(c).achievements.title},null,8,["achievements","title"]),q(Zt,{show:s(m)&&s(f),"next-level-is-text":s(c).result.nextLevelIs,"level-name":s(w),icon:s($),hint:s(I)},null,8,["show","next-level-is-text","level-name","icon","hint"]),t("div",an,[q(s(W),{size:"large",onClick:B[0]||(B[0]=K=>N.$emit("home")),class:"action-btn"},{default:O(()=>[x(n(s(c).result.home),1)]),_:1}),q(s(W),{size:"large",type:"primary",onClick:B[1]||(B[1]=K=>N.$emit("retry")),class:"action-btn"},{default:O(()=>[x(n(s(c).result.tryAgain),1)]),_:1}),s(m)&&s(f)?(o(),ne(s(W),{key:0,size:"large",type:"success",onClick:B[2]||(B[2]=K=>N.$emit("next")),class:"action-btn"},{default:O(()=>[x(n(s(c).result.nextLevel),1)]),_:1})):_("",!0)]),q(s(W),{text:"",onClick:B[3]||(B[3]=K=>T.value=!s(T)),style:{"margin-top":"20px"}},{default:O(()=>[x(n(s(T)?s(c).result.hideDetails:s(c).result.showDetails),1)]),_:1}),s(T)?(o(),i("div",ln,[q(Qe,{answers:s(l).answers,operation:e.operation},null,8,["answers","operation"])])):_("",!0)],2),q(Ye,{ref_key:"coinAnimationRef",ref:k},null,512),q(wt,{show:s(d),stickers:s(L),title:((Q=s(c).result)==null?void 0:Q.newStickers)||"New Sticker!","close-text":((H=s(c).common)==null?void 0:H.close)||"Awesome!",onClose:s(P)},null,8,["show","stickers","title","close-text","onClose"])])}}},vn=U(un,[["__scopeId","data-v-9eb0a4e2"]]);export{vn as default};
